# 実装計画

## 基盤構築

- [x] 1. プロジェクト基盤とコア構造の設定
  - Next.js + TypeScript プロジェクトの初期化
  - FastAPI バックエンドプロジェクトの初期化
  - 基本的なディレクトリ構造とコア型定義の作成
  - Python 仮想環境（venv）の設定と Git 管理設定
  - _要件: 1.1, 4.1_

## バックエンド開発タスク

### データモデルと API 基盤

- [ ] 2. **[Backend]** Pydantic データモデルの実装

  - バックエンド用のデータモデルクラスの作成
  - 入力検証とシリアライゼーション機能の実装
  - Character, PassiveSkill, DamageCalculationRequest, DamageCalculationResult モデルの完成
  - _要件: 4.4, 5.3_

- [ ] 3. **[Backend]** 外部 API 統合クライアントの実装
  - HTTP クライアント (httpx) を使用した API 通信機能の実装
  - タイムアウト、リトライ、エラーハンドリング機能の実装
  - 外部 API レスポンスの検証と正規化処理の実装
  - キャラクターデータのキャッシュ機能の実装
  - _要件: 1.4, 5.1, 5.3, 5.4, 5.5_

### ダメージ計算エンジン

- [ ] 4. **[Backend]** パッシブスキル計算エンジンの実装

  - 防御力ブースト、ダメージ軽減、ガード能力の計算関数を実装
  - モジュラー設計でスキルタイプ別の処理を分離
  - DEF 無限上昇計算機能の実装（スタッキング防御力の段階的計算）
  - 攻撃回数に基づく防御力増加の処理を実装
  - _要件: 2.2, 2.3, 5.2, 6.1, 6.2, 6.3_

- [ ] 5. **[Backend]** ダメージ計算コアロジックの実装
  - DEF ステータス、リーダースキル倍率、パッシブスキルを統合した実効防御力計算処理
  - 複数の修正値を正しい順序で適用する機能
  - 実効防御力と敵アタック値の比較処理
  - ダメージ値の計算とエッジケース処理（ゼロダメージ、マイナス値処理）
  - _要件: 2.1, 2.2, 3.1, 3.2, 3.3, 3.4, 6.3_

### API エンドポイント

- [ ] 6. **[Backend]** FastAPI エンドポイントの実装

  - POST /api/calculate-damage エンドポイントの実装
  - GET /api/characters エンドポイントの実装
  - GET /api/characters/{id} エンドポイントの実装
  - リクエスト検証とレスポンス形式の実装
  - 外部 API 統合とエラーハンドリングの実装
  - _要件: 1.4, 4.1, 4.3, 4.4, 5.1, 5.5_

- [ ] 7. **[Backend]** バックエンドエラーハンドリングの実装
  - 外部 API 障害時の適切なエラーレスポンス
  - 統一されたエラーレスポンス形式の実装
  - ログ機能とモニタリング機能の実装
  - _要件: 5.1, 5.5_

## フロントエンド開発タスク

### 型定義とユーティリティ

- [ ] 8. **[Frontend]** TypeScript 型定義とユーティリティの実装
  - Character, PassiveSkill, DamageCalculationRequest, DamageCalculationResult インターフェースの完成
  - 型安全性を確保するための検証関数の作成
  - API クライアント機能の拡張とエラーハンドリング
  - ユーティリティ関数の拡張（フォーマット、バリデーション）
  - _要件: 1.2, 1.3, 2.2_

### UI コンポーネント

- [ ] 9. **[Frontend]** キャラクター選択コンポーネントの作成

  - CharacterSelector コンポーネントの実装
  - 検索・フィルタリング機能とローディング状態の実装
  - キャラクター一覧表示とプレビュー機能
  - _要件: 1.4, 5.4_

- [ ] 10. **[Frontend]** ダメージ計算フォームコンポーネントの作成

  - DamageCalculatorForm コンポーネントの実装
  - 入力検証とリアルタイムフィードバック機能の実装
  - DEF 無限上昇キャラクター用の攻撃回数入力機能
  - フォーム状態管理とユーザビリティ向上
  - _要件: 1.1, 1.2, 1.3, 1.5_

- [ ] 11. **[Frontend]** 結果表示コンポーネントの作成
  - DamageResultDisplay コンポーネントの実装
  - 計算結果の詳細表示とスタッキングキャラクター対応
  - 計算過程の可視化と説明機能
  - 結果の比較・保存機能
  - _要件: 3.5, 6.5_

### エラーハンドリングと UX

- [ ] 12. **[Frontend]** フロントエンドエラーハンドリングと UX の実装
  - API 通信エラーの処理とユーザーフィードバック
  - トースト通知とリトライ機能の実装
  - ローディング状態とスケルトン UI
  - レスポンシブデザインとアクセシビリティ対応
  - _要件: 5.4, 5.5_

## テストとデプロイ

### テスト実装

- [ ] 13. **[Backend]** バックエンド単体テストの作成

  - ダメージ計算ロジックのテストケース作成
  - 外部 API 統合のモックテスト実装
  - パッシブスキル計算の網羅的テスト
  - エラーハンドリングのテスト
  - _要件: 2.1, 2.2, 2.3, 3.1, 3.2, 3.3_

- [ ] 14. **[Frontend]** フロントエンド単体テストの作成
  - React コンポーネントのテストケース作成
  - ユーザーインタラクションのテスト実装
  - API クライアントのテスト
  - フォームバリデーションのテスト
  - _要件: 1.1, 1.2, 1.3, 1.4, 1.5_

### 統合とデプロイ

- [ ] 15. **[Full-Stack]** 統合テストの実装

  - エンドツーエンドの API 通信テスト
  - 実際の外部 API を使用した統合テスト
  - フロントエンド・バックエンド間の通信テスト
  - _要件: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 16. **[DevOps]** 本番環境設定とデプロイ準備
  - 環境変数設定とセキュリティ設定の実装
  - Vercel (フロントエンド) のデプロイ設定
  - Railway/Heroku (バックエンド) のデプロイ設定
  - CI/CD パイプラインの設定
  - _要件: 4.5_

## 開発順序の推奨

### フェーズ 1: バックエンド基盤

1. タスク 2: Pydantic データモデル
2. タスク 3: 外部 API 統合クライアント
3. タスク 4: パッシブスキル計算エンジン

### フェーズ 2: コア機能

4. タスク 5: ダメージ計算コアロジック
5. タスク 6: FastAPI エンドポイント
6. タスク 8: TypeScript 型定義とユーティリティ

### フェーズ 3: フロントエンド UI

7. タスク 9: キャラクター選択コンポーネント
8. タスク 10: ダメージ計算フォーム
9. タスク 11: 結果表示コンポーネント

### フェーズ 4: 品質向上

10. タスク 7: バックエンドエラーハンドリング
11. タスク 12: フロントエンドエラーハンドリング
12. タスク 13-14: テスト実装

### フェーズ 5: デプロイ

13. タスク 15: 統合テスト
14. タスク 16: 本番環境設定
